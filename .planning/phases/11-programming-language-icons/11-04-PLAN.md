---
phase: 11-programming-language-icons
plan: 04
type: execute
wave: 3
depends_on: ["11-02", "11-03"]
files_modified:
  - src/app/backstage/dashboard/skills/skills-manager.tsx
  - src/components/admin/sortable-skill-item.tsx
  - src/app/components/portfolio/skill-card.tsx
  - src/lib/actions/skills.ts
autonomous: false

must_haves:
  truths:
    - "Admin skill form shows icon picker button instead of text input"
    - "Clicking icon picker button opens IconPickerModal"
    - "Selected icon appears in skill form preview"
    - "Creating/editing skill saves iconType and iconId to database"
    - "Public skill cards display devicons for skills with iconType='devicon'"
    - "Skills with iconType='lucide' continue showing Lucide icons"
    - "Sortable skill items in admin show same TechIcon as public"
  artifacts:
    - path: "src/app/backstage/dashboard/skills/skills-manager.tsx"
      provides: "Updated SkillFormModal with icon picker integration"
      contains: "IconPickerModal"
    - path: "src/components/admin/sortable-skill-item.tsx"
      provides: "Updated skill item with TechIcon component"
      contains: "TechIcon"
    - path: "src/app/components/portfolio/skill-card.tsx"
      provides: "Updated public skill card with TechIcon component"
      contains: "TechIcon"
    - path: "src/lib/actions/skills.ts"
      provides: "Updated server actions handling iconType and iconId"
      contains: "iconType"
  key_links:
    - from: "src/app/backstage/dashboard/skills/skills-manager.tsx"
      to: "src/components/admin/icon-picker/icon-picker-modal.tsx"
      via: "IconPickerModal import and usage"
      pattern: "IconPickerModal"
    - from: "src/app/components/portfolio/skill-card.tsx"
      to: "src/components/ui/tech-icon.tsx"
      via: "TechIcon component"
      pattern: "TechIcon"
---

<objective>
Integrate icon picker into admin skill form, update server actions for dual icon system, and update public skill display to use TechIcon component.

Purpose: Complete the icon system integration so admin can select tech icons and they display correctly on public portfolio.
Output: Functional end-to-end icon selection from admin to public display.
</objective>

<execution_context>
@/Users/uzi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/uzi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-programming-language-icons/11-CONTEXT.md
@.planning/phases/11-programming-language-icons/11-RESEARCH.md
@.planning/phases/11-programming-language-icons/11-01-SUMMARY.md
@.planning/phases/11-programming-language-icons/11-02-SUMMARY.md
@.planning/phases/11-programming-language-icons/11-03-SUMMARY.md
@src/app/backstage/dashboard/skills/skills-manager.tsx
@src/components/admin/sortable-skill-item.tsx
@src/app/components/portfolio/skill-card.tsx
@src/lib/actions/skills.ts
@src/lib/validations/skill.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update server actions for dual icon system</name>
  <files>src/lib/actions/skills.ts</files>
  <action>
    Update src/lib/actions/skills.ts to handle iconType and iconId fields:

    1. Update createSkill function:
       - Extract iconType and iconId from formData instead of icon
       - Default iconType to "lucide" if not provided
       - Default iconId to "code" if not provided
       - Save to database with new field names

    ```typescript
    export async function createSkill(formData: FormData): Promise<ActionResult<Skill>> {
      const session = await auth();
      if (!session?.user) {
        return failure("Not authenticated");
      }

      const rawData = {
        name: formData.get("name"),
        iconType: formData.get("iconType") || "lucide",
        iconId: formData.get("iconId") || "code",
        category: formData.get("category"),
      };

      const parsed = skillSchema.safeParse(rawData);
      if (!parsed.success) {
        const firstError = parsed.error.issues[0];
        return failure(firstError?.message || "Invalid skill data");
      }

      try {
        const maxOrderSkill = await prisma.skill.findFirst({
          where: { category: parsed.data.category },
          orderBy: { order: "desc" },
          select: { order: true },
        });

        const newOrder = (maxOrderSkill?.order ?? -1) + 1;

        const skill = await prisma.skill.create({
          data: {
            name: parsed.data.name,
            iconType: parsed.data.iconType,
            iconId: parsed.data.iconId,
            category: parsed.data.category,
            order: newOrder,
          },
        });

        revalidatePath("/backstage/dashboard/skills");
        revalidatePath("/");
        return success(skill);
      } catch (error) {
        console.error("Failed to create skill:", error);
        return failure("Failed to create skill");
      }
    }
    ```

    2. Update updateSkill function similarly:
       - Extract iconType and iconId from formData
       - Save to database with new field names

    3. No changes needed for deleteSkill, updateSkillsOrder, updateCategoryOrder (they don't touch icon fields)
  </action>
  <verify>
    - TypeScript compiles: `npx tsc --noEmit`
    - createSkill and updateSkill accept iconType and iconId
    - Server actions return updated Skill type with iconType and iconId
  </verify>
  <done>
    - createSkill saves iconType and iconId to database
    - updateSkill saves iconType and iconId to database
    - Default values: iconType="lucide", iconId="code"
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate icon picker into skill form modal</name>
  <files>src/app/backstage/dashboard/skills/skills-manager.tsx</files>
  <action>
    Update SkillFormModal in skills-manager.tsx:

    1. Add imports:
    ```typescript
    import { IconPickerModal } from "@/components/admin/icon-picker/icon-picker-modal";
    import { TechIcon } from "@/components/ui/tech-icon";
    import { findMatchingIcon } from "@/lib/icons/icon-matcher";
    ```

    2. Add state for icon picker and selection:
    ```typescript
    const [isIconPickerOpen, setIsIconPickerOpen] = useState(false);
    const [selectedIconType, setSelectedIconType] = useState<"devicon" | "lucide">(
      skill?.iconType === "devicon" ? "devicon" : "lucide"
    );
    const [selectedIconId, setSelectedIconId] = useState(skill?.iconId || "code");
    ```

    3. Replace icon text input with icon picker button:
    ```typescript
    {/* Icon selector */}
    <div>
      <label
        className="block text-sm font-medium mb-1"
        style={{ color: "rgba(243, 233, 226, 0.8)" }}
      >
        Icon
      </label>
      <button
        type="button"
        onClick={() => setIsIconPickerOpen(true)}
        className="w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors text-left"
        style={{
          backgroundColor: "rgba(243, 233, 226, 0.05)",
          border: "1px solid rgba(243, 233, 226, 0.2)",
          color: "var(--color-text)",
        }}
      >
        <TechIcon
          iconType={selectedIconType}
          iconId={selectedIconId}
          skillCategory={currentCategory}
          size={24}
        />
        <span className="flex-1 truncate">
          {selectedIconType === "devicon"
            ? DEVICON_MAP.get(selectedIconId)?.name || selectedIconId
            : `Lucide: ${selectedIconId}`}
        </span>
        <span
          className="text-sm"
          style={{ color: "rgba(243, 233, 226, 0.5)" }}
        >
          Change
        </span>
      </button>

      {/* Hidden inputs for form submission */}
      <input type="hidden" name="iconType" value={selectedIconType} />
      <input type="hidden" name="iconId" value={selectedIconId} />
    </div>
    ```

    4. Add icon picker modal:
    ```typescript
    <IconPickerModal
      isOpen={isIconPickerOpen}
      onClose={() => setIsIconPickerOpen(false)}
      onSelect={(iconId, iconType) => {
        setSelectedIconType(iconType);
        setSelectedIconId(iconId || "code");
      }}
      currentIconId={selectedIconType === "devicon" ? selectedIconId : null}
    />
    ```

    5. Add auto-suggest when name changes (for add mode):
    ```typescript
    // In the name input's onChange handler (or use useEffect):
    // When name changes in add mode, auto-suggest matching icon
    const handleNameChange = (name: string) => {
      if (mode === "add") {
        const match = findMatchingIcon(name);
        if (match) {
          setSelectedIconType("devicon");
          setSelectedIconId(match.id);
        }
      }
    };
    ```

    6. Track current category for fallback:
    ```typescript
    const [currentCategory, setCurrentCategory] = useState<SkillCategory>(
      skill?.category as SkillCategory || "frontend"
    );
    ```

    7. Update category select to update currentCategory state
  </action>
  <verify>
    - TypeScript compiles: `npx tsc --noEmit`
    - Run dev server and navigate to /backstage/dashboard/skills
    - Click "Add Skill" - icon picker button appears instead of text input
    - Click icon picker button - modal opens
    - Select an icon - modal closes, button shows selected icon
    - Submit form - skill saves with correct iconType and iconId
  </verify>
  <done>
    - Icon picker button replaces text input in skill form
    - Clicking button opens IconPickerModal
    - Selected icon shown in button with preview
    - Hidden inputs send iconType and iconId with form
    - Auto-suggest fills icon when skill name matches (add mode)
  </done>
</task>

<task type="auto">
  <name>Task 3: Update sortable skill item and public skill card</name>
  <files>src/components/admin/sortable-skill-item.tsx, src/app/components/portfolio/skill-card.tsx</files>
  <action>
    1. Update src/components/admin/sortable-skill-item.tsx:
       - Import TechIcon: `import { TechIcon } from "@/components/ui/tech-icon";`
       - Remove DynamicIcon helper function (no longer needed)
       - Replace DynamicIcon usage with TechIcon:

       ```typescript
       {/* Skill icon */}
       <div
         className="w-8 h-8 rounded-lg flex items-center justify-center"
         style={{ backgroundColor: "rgba(211, 177, 150, 0.15)" }}
       >
         <TechIcon
           iconType={skill.iconType as "devicon" | "lucide"}
           iconId={skill.iconId}
           skillCategory={skill.category as SkillCategory}
           size={16}
         />
       </div>
       ```

       - Import SkillCategory type: `import type { SkillCategory } from "@/lib/validations/skill";`

    2. Update src/app/components/portfolio/skill-card.tsx:
       - Import TechIcon: `import { TechIcon } from "@/components/ui/tech-icon";`
       - Remove getIconComponent helper function
       - Update props interface:
         ```typescript
         interface SkillCardProps {
           name: string;
           iconType: "devicon" | "lucide";
           iconId: string;
           category: string;
         }
         ```
       - Replace icon rendering with TechIcon:
         ```typescript
         <TechIcon
           iconType={iconType}
           iconId={iconId}
           skillCategory={category as SkillCategory}
           size={20}
           className="flex-shrink-0"
         />
         ```
       - Keep style: color: "var(--color-primary)"

    3. Update skill-card usage in skills-section.tsx:
       - Pass iconType, iconId, and category to SkillCard:
         ```typescript
         <SkillCard
           name={skill.name}
           iconType={skill.iconType as "devicon" | "lucide"}
           iconId={skill.iconId}
           category={skill.category}
         />
         ```
  </action>
  <verify>
    - TypeScript compiles: `npx tsc --noEmit`
    - Admin skill list shows TechIcon for each skill
    - Public portfolio shows TechIcon for each skill
    - Skills with iconType="lucide" still show correct Lucide icon
    - Skills with iconType="devicon" show tech logo
  </verify>
  <done>
    - SortableSkillItem uses TechIcon instead of DynamicIcon
    - SkillCard uses TechIcon with iconType/iconId props
    - skills-section.tsx passes new props to SkillCard
    - Consistent icon display in admin and public views
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete tech icon system: icon picker in admin, devicons displaying on public portfolio</what-built>
  <how-to-verify>
    1. Start dev server: `npm run dev`
    2. Navigate to http://localhost:3000/backstage/dashboard/skills
    3. Click "Add Skill":
       - Type "React" - icon should auto-suggest React devicon
       - Click icon button to open picker
       - Search for "Python" - Python icon appears
       - Select it - modal closes, icon shows in form
       - Fill name "Test Skill", select category
       - Click "Add Skill" - skill appears in list with devicon
    4. Navigate to http://localhost:3000 (public portfolio):
       - Scroll to Skills section
       - New skill should show devicon (tech logo)
       - Existing skills show Lucide icons (backwards compatible)
    5. Edit a skill:
       - Click edit on existing skill
       - Change icon via picker
       - Save - verify icon updates on public page
    6. Check consistency:
       - Same icon appears in admin list and public portfolio
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues</resume-signal>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npx tsc --noEmit` passes
2. Admin can add skill with devicon via picker
3. Admin can edit skill icon
4. Public portfolio displays devicons correctly
5. Lucide fallback works for skills without devicon
6. Icon selection persists across page refresh
7. Auto-suggest matches skill name to icon
8. Recent icons shown in picker
</verification>

<success_criteria>
- Icon picker opens from skill form in admin dashboard
- Selected tech icon displays in form preview
- Creating skill saves iconType="devicon" and iconId to database
- Editing skill updates icon correctly
- Public skill cards show recognizable tech logos (devicons)
- Skills with iconType="lucide" continue showing Lucide icons (backwards compat)
- Same icon appears in both admin list and public portfolio
- Auto-suggest fills icon when skill name matches available devicon
</success_criteria>

<output>
After completion, create `.planning/phases/11-programming-language-icons/11-04-SUMMARY.md`
</output>
