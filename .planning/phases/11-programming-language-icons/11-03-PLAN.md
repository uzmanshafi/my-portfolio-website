---
phase: 11-programming-language-icons
plan: 03
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - src/components/admin/icon-picker/icon-picker-modal.tsx
  - src/components/admin/icon-picker/icon-grid.tsx
  - src/components/admin/icon-picker/icon-search.tsx
autonomous: true

must_haves:
  truths:
    - "Icon picker opens as modal overlay with search and category tabs"
    - "User can type to search icons by name, id, or alias"
    - "User can click category tabs to filter icons by type"
    - "Arrow keys navigate grid, Enter selects, Escape closes"
    - "Recent icons section shows last 8 selected icons at top"
    - "Clicking an icon immediately calls onSelect and closes modal"
  artifacts:
    - path: "src/components/admin/icon-picker/icon-picker-modal.tsx"
      provides: "Main modal component with layout and state management"
      exports: ["IconPickerModal"]
    - path: "src/components/admin/icon-picker/icon-grid.tsx"
      provides: "Grid display with keyboard navigation"
      exports: ["IconGrid"]
    - path: "src/components/admin/icon-picker/icon-search.tsx"
      provides: "Search input component"
      exports: ["IconSearch"]
  key_links:
    - from: "src/components/admin/icon-picker/icon-picker-modal.tsx"
      to: "src/lib/icons/devicon-registry.ts"
      via: "DEVICON_REGISTRY filtering"
      pattern: "DEVICON_REGISTRY\\.filter"
    - from: "src/components/admin/icon-picker/icon-picker-modal.tsx"
      to: "src/hooks/use-recent-icons.ts"
      via: "useRecentIcons hook"
      pattern: "useRecentIcons"
---

<objective>
Build the icon picker modal with search functionality, category filtering, keyboard navigation, and recent icons display.

Purpose: This is the primary admin UI for selecting tech icons when adding/editing skills.
Output: Fully functional icon picker modal with professional UX (search, filter, keyboard nav).
</objective>

<execution_context>
@/Users/uzi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/uzi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-programming-language-icons/11-CONTEXT.md
@.planning/phases/11-programming-language-icons/11-RESEARCH.md
@.planning/phases/11-programming-language-icons/11-01-SUMMARY.md
@src/lib/icons/devicon-registry.ts
@src/lib/icons/icon-categories.ts
@src/hooks/use-recent-icons.ts
@src/app/backstage/dashboard/skills/skills-manager.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create icon picker modal with search and categories</name>
  <files>src/components/admin/icon-picker/icon-picker-modal.tsx, src/components/admin/icon-picker/icon-search.tsx</files>
  <action>
    1. Create src/components/admin/icon-picker/icon-search.tsx:

    ```typescript
    "use client";

    import { Search } from "lucide-react";
    import { useRef, useEffect } from "react";

    interface IconSearchProps {
      value: string;
      onChange: (value: string) => void;
      placeholder?: string;
    }

    export function IconSearch({
      value,
      onChange,
      placeholder = "Search icons...",
    }: IconSearchProps) {
      const inputRef = useRef<HTMLInputElement>(null);

      // Auto-focus on mount
      useEffect(() => {
        inputRef.current?.focus();
      }, []);

      return (
        <div className="relative">
          <Search
            size={18}
            className="absolute left-3 top-1/2 -translate-y-1/2"
            style={{ color: "rgba(243, 233, 226, 0.5)" }}
          />
          <input
            ref={inputRef}
            type="text"
            value={value}
            onChange={(e) => onChange(e.target.value)}
            placeholder={placeholder}
            className="w-full pl-10 pr-4 py-2 rounded-lg transition-colors"
            style={{
              backgroundColor: "rgba(243, 233, 226, 0.05)",
              border: "1px solid rgba(243, 233, 226, 0.2)",
              color: "var(--color-text)",
            }}
          />
        </div>
      );
    }
    ```

    2. Create src/components/admin/icon-picker/icon-picker-modal.tsx:

    ```typescript
    "use client";

    import { useState, useEffect, useCallback } from "react";
    import { X } from "lucide-react";
    import {
      DEVICON_REGISTRY,
      DEVICON_MAP,
      type IconCategory,
    } from "@/lib/icons/devicon-registry";
    import { DEVICON_CATEGORIES } from "@/lib/icons/icon-categories";
    import { useRecentIcons } from "@/hooks/use-recent-icons";
    import { IconSearch } from "./icon-search";
    import { IconGrid } from "./icon-grid";

    interface IconPickerModalProps {
      isOpen: boolean;
      onClose: () => void;
      onSelect: (iconId: string | null, iconType: "devicon" | "lucide") => void;
      currentIconId: string | null;
    }

    export function IconPickerModal({
      isOpen,
      onClose,
      onSelect,
      currentIconId,
    }: IconPickerModalProps) {
      const [search, setSearch] = useState("");
      const [category, setCategory] = useState<IconCategory | "all">("all");
      const [focusIndex, setFocusIndex] = useState(0);
      const { recentIcons, addRecentIcon } = useRecentIcons();

      // Filter icons based on search and category
      const filteredIcons = DEVICON_REGISTRY.filter((icon) => {
        const matchesCategory =
          category === "all" || icon.category === category;

        if (!search.trim()) return matchesCategory;

        const searchLower = search.toLowerCase();
        const matchesSearch =
          icon.name.toLowerCase().includes(searchLower) ||
          icon.id.includes(searchLower) ||
          icon.aliases.some((alias) => alias.includes(searchLower));

        return matchesCategory && matchesSearch;
      });

      // Get recent icons that exist in registry
      const validRecentIcons = recentIcons
        .map((id) => DEVICON_MAP.get(id))
        .filter(Boolean);

      // Calculate grid columns for keyboard nav (matches CSS grid)
      const columns = 6;

      // Reset focus when filter changes
      useEffect(() => {
        setFocusIndex(0);
      }, [search, category]);

      // Handle icon selection
      const handleSelect = useCallback(
        (iconId: string | null) => {
          if (iconId) {
            addRecentIcon(iconId);
            onSelect(iconId, "devicon");
          } else {
            // "Use default" option - use Lucide
            onSelect(null, "lucide");
          }
          onClose();
        },
        [addRecentIcon, onSelect, onClose]
      );

      // Keyboard navigation
      const handleKeyDown = useCallback(
        (e: KeyboardEvent) => {
          if (!isOpen) return;

          switch (e.key) {
            case "Escape":
              e.preventDefault();
              onClose();
              break;
            case "ArrowRight":
              e.preventDefault();
              setFocusIndex((i) => Math.min(i + 1, filteredIcons.length - 1));
              break;
            case "ArrowLeft":
              e.preventDefault();
              setFocusIndex((i) => Math.max(i - 1, 0));
              break;
            case "ArrowDown":
              e.preventDefault();
              setFocusIndex((i) =>
                Math.min(i + columns, filteredIcons.length - 1)
              );
              break;
            case "ArrowUp":
              e.preventDefault();
              setFocusIndex((i) => Math.max(i - columns, 0));
              break;
            case "Enter":
              e.preventDefault();
              if (filteredIcons[focusIndex]) {
                handleSelect(filteredIcons[focusIndex].id);
              }
              break;
          }
        },
        [isOpen, filteredIcons, focusIndex, columns, onClose, handleSelect]
      );

      useEffect(() => {
        document.addEventListener("keydown", handleKeyDown);
        return () => document.removeEventListener("keydown", handleKeyDown);
      }, [handleKeyDown]);

      // Reset state when modal opens
      useEffect(() => {
        if (isOpen) {
          setSearch("");
          setCategory("all");
          setFocusIndex(0);
        }
      }, [isOpen]);

      if (!isOpen) return null;

      return (
        <div className="fixed inset-0 z-50 flex items-center justify-center">
          {/* Backdrop */}
          <div
            className="absolute inset-0 bg-black/70"
            onClick={onClose}
          />

          {/* Modal */}
          <div
            className="relative w-full max-w-2xl max-h-[80vh] mx-4 rounded-xl flex flex-col overflow-hidden"
            style={{ backgroundColor: "var(--color-background)" }}
          >
            {/* Header */}
            <div
              className="flex items-center justify-between px-6 py-4 border-b"
              style={{ borderColor: "rgba(243, 233, 226, 0.1)" }}
            >
              <h2
                className="text-lg font-semibold"
                style={{ color: "var(--color-text)" }}
              >
                Select Icon
              </h2>
              <button
                onClick={onClose}
                className="p-1 rounded hover:bg-white/10 transition-colors"
                style={{ color: "var(--color-text)" }}
              >
                <X size={20} />
              </button>
            </div>

            {/* Search and category tabs */}
            <div className="px-6 py-4 space-y-4">
              <IconSearch value={search} onChange={setSearch} />

              {/* Category tabs */}
              <div className="flex flex-wrap gap-2">
                {DEVICON_CATEGORIES.map((cat) => (
                  <button
                    key={cat.value}
                    onClick={() => setCategory(cat.value)}
                    className="px-3 py-1.5 text-sm rounded-lg transition-colors"
                    style={{
                      backgroundColor:
                        category === cat.value
                          ? "var(--color-primary)"
                          : "rgba(243, 233, 226, 0.1)",
                      color:
                        category === cat.value
                          ? "var(--color-background)"
                          : "var(--color-text)",
                    }}
                  >
                    {cat.label}
                  </button>
                ))}
              </div>
            </div>

            {/* Content area (scrollable) */}
            <div className="flex-1 overflow-y-auto px-6 pb-6">
              {/* Use default option */}
              <button
                onClick={() => handleSelect(null)}
                className="w-full mb-4 px-4 py-2 text-sm rounded-lg text-left transition-colors hover:bg-white/10"
                style={{
                  backgroundColor: "rgba(243, 233, 226, 0.05)",
                  border: "1px solid rgba(243, 233, 226, 0.1)",
                  color: "rgba(243, 233, 226, 0.7)",
                }}
              >
                Use category default icon (Lucide)
              </button>

              {/* Recent icons */}
              {validRecentIcons.length > 0 && !search && category === "all" && (
                <div className="mb-6">
                  <h3
                    className="text-sm font-medium mb-2"
                    style={{ color: "rgba(243, 233, 226, 0.6)" }}
                  >
                    Recently used
                  </h3>
                  <IconGrid
                    icons={validRecentIcons}
                    focusIndex={-1}
                    onSelect={handleSelect}
                    currentIconId={currentIconId}
                  />
                </div>
              )}

              {/* All icons */}
              <h3
                className="text-sm font-medium mb-2"
                style={{ color: "rgba(243, 233, 226, 0.6)" }}
              >
                {search
                  ? `${filteredIcons.length} results`
                  : category === "all"
                  ? "All icons"
                  : `${category.charAt(0).toUpperCase() + category.slice(1)}`}
              </h3>

              {filteredIcons.length > 0 ? (
                <IconGrid
                  icons={filteredIcons}
                  focusIndex={focusIndex}
                  onSelect={handleSelect}
                  currentIconId={currentIconId}
                />
              ) : (
                <p
                  className="text-center py-8"
                  style={{ color: "rgba(243, 233, 226, 0.5)" }}
                >
                  No icons found
                </p>
              )}
            </div>

            {/* Footer hint */}
            <div
              className="px-6 py-3 text-xs border-t"
              style={{
                borderColor: "rgba(243, 233, 226, 0.1)",
                color: "rgba(243, 233, 226, 0.4)",
              }}
            >
              Arrow keys to navigate, Enter to select, Escape to close
            </div>
          </div>
        </div>
      );
    }
    ```
  </action>
  <verify>
    - TypeScript compiles: `npx tsc --noEmit`
    - IconPickerModal and IconSearch export correctly
    - Modal structure matches existing SkillFormModal pattern
  </verify>
  <done>
    - IconSearch component with auto-focus and design system styling
    - IconPickerModal with search, category tabs, and keyboard navigation
    - "Use default" option for Lucide fallback
    - Recent icons section when no search/filter active
    - Keyboard navigation: arrows navigate, Enter selects, Escape closes
  </done>
</task>

<task type="auto">
  <name>Task 2: Create icon grid component with tooltip and focus state</name>
  <files>src/components/admin/icon-picker/icon-grid.tsx</files>
  <action>
    Create src/components/admin/icon-picker/icon-grid.tsx:

    ```typescript
    "use client";

    import { useRef, useEffect, useState } from "react";
    import type { DeviconEntry } from "@/lib/icons/devicon-registry";

    interface IconGridProps {
      icons: DeviconEntry[];
      focusIndex: number;
      onSelect: (iconId: string) => void;
      currentIconId: string | null;
    }

    export function IconGrid({
      icons,
      focusIndex,
      onSelect,
      currentIconId,
    }: IconGridProps) {
      const gridRef = useRef<HTMLDivElement>(null);
      const [hoveredIndex, setHoveredIndex] = useState<number | null>(null);

      // Scroll focused item into view
      useEffect(() => {
        if (focusIndex >= 0 && gridRef.current) {
          const items = gridRef.current.querySelectorAll("[data-icon-item]");
          const item = items[focusIndex];
          if (item) {
            item.scrollIntoView({ block: "nearest", behavior: "smooth" });
          }
        }
      }, [focusIndex]);

      return (
        <div
          ref={gridRef}
          className="grid grid-cols-4 sm:grid-cols-6 gap-2"
          role="listbox"
        >
          {icons.map((icon, index) => {
            const IconComponent = icon.component;
            const isSelected = icon.id === currentIconId;
            const isFocused = index === focusIndex;
            const isHovered = index === hoveredIndex;

            return (
              <button
                key={icon.id}
                data-icon-item
                onClick={() => onSelect(icon.id)}
                onMouseEnter={() => setHoveredIndex(index)}
                onMouseLeave={() => setHoveredIndex(null)}
                className="relative flex flex-col items-center justify-center p-3 rounded-lg transition-colors group"
                style={{
                  backgroundColor: isSelected
                    ? "rgba(211, 177, 150, 0.3)"
                    : isFocused
                    ? "rgba(243, 233, 226, 0.15)"
                    : "rgba(243, 233, 226, 0.05)",
                  border: isSelected
                    ? "2px solid var(--color-primary)"
                    : isFocused
                    ? "2px solid rgba(243, 233, 226, 0.3)"
                    : "2px solid transparent",
                }}
                role="option"
                aria-selected={isSelected}
                aria-label={icon.name}
              >
                <IconComponent
                  color="currentColor"
                  style={{
                    width: 24,
                    height: 24,
                    color: isSelected
                      ? "var(--color-primary)"
                      : "var(--color-text)",
                  }}
                />

                {/* Tooltip on hover */}
                {isHovered && (
                  <div
                    className="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 text-xs rounded whitespace-nowrap z-10"
                    style={{
                      backgroundColor: "var(--color-background)",
                      border: "1px solid rgba(243, 233, 226, 0.2)",
                      color: "var(--color-text)",
                      boxShadow: "0 4px 12px rgba(0, 0, 0, 0.3)",
                    }}
                  >
                    {icon.name}
                  </div>
                )}
              </button>
            );
          })}
        </div>
      );
    }
    ```

    Key implementation details:
    - 4 columns on mobile, 6 on sm+ (matches modal width)
    - Selected icon has primary color border and background
    - Focused icon (keyboard nav) has lighter border
    - Tooltip appears on hover showing icon name
    - Auto-scroll focused item into view
    - role="listbox" and aria-selected for accessibility
    - Icons rendered with currentColor for monochrome appearance
  </action>
  <verify>
    - TypeScript compiles: `npx tsc --noEmit`
    - IconGrid exports correctly
    - Grid uses responsive columns (4 on mobile, 6 on sm+)
    - Tooltip shows icon name on hover
  </verify>
  <done>
    - IconGrid renders responsive grid of devicon buttons
    - Selected icon highlighted with primary color
    - Focused icon (keyboard nav) has visible focus state
    - Tooltip shows icon name on hover
    - Auto-scroll keeps focused item in view
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npx tsc --noEmit` passes with no type errors
2. IconPickerModal opens with search input auto-focused
3. Typing in search filters icons by name/id/alias
4. Category tabs filter icons by type
5. Arrow keys move focus through grid
6. Enter selects focused icon
7. Escape closes modal
8. Tooltip shows icon name on hover
9. Recent icons section appears when no search active
</verification>

<success_criteria>
- Icon picker modal opens as overlay with dark backdrop
- Search filters icons instantly by name, id, or aliases
- Category tabs filter by Languages, Frameworks, Databases, etc.
- Arrow keys navigate grid, Enter selects, Escape closes
- Recent icons (up to 8) shown at top when no search/filter
- Tooltip displays icon name on hover
- Selected icon has visible highlight state
- "Use default" option returns to Lucide fallback
</success_criteria>

<output>
After completion, create `.planning/phases/11-programming-language-icons/11-03-SUMMARY.md`
</output>
