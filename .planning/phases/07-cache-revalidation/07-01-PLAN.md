---
phase: 07-cache-revalidation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/actions/contact.ts
  - src/lib/actions/social-links.ts
  - src/lib/actions/resume.ts
  - src/lib/actions/skills.ts
  - src/lib/actions/projects.ts
  - src/lib/actions/github.ts
  - src/app/backstage/dashboard/bio/bio-form.tsx
  - src/app/backstage/dashboard/contact/contact-manager.tsx
  - src/app/backstage/dashboard/resume/resume-manager.tsx
  - src/app/backstage/dashboard/skills/skills-manager.tsx
  - src/app/backstage/dashboard/projects/projects-manager.tsx
  - src/components/admin/project-form-modal.tsx
autonomous: true

must_haves:
  truths:
    - "Admin saves content in dashboard, immediately views public page and sees the change (no 60-second wait)"
    - "Toast notification confirms 'now live' or 'visible on site' after successful save"
    - "All server actions that modify bio, skills, projects, resume, or contact call revalidatePath"
  artifacts:
    - path: "src/lib/actions/contact.ts"
      provides: "Contact update with public revalidation"
      contains: "revalidatePath(\"/\")"
    - path: "src/lib/actions/social-links.ts"
      provides: "Social link CRUD with public revalidation"
      contains: "revalidatePath(\"/\")"
    - path: "src/lib/actions/resume.ts"
      provides: "Resume upload/delete with public revalidation"
      contains: "revalidatePath(\"/\")"
    - path: "src/lib/actions/skills.ts"
      provides: "Skills CRUD with public revalidation"
      contains: "revalidatePath(\"/\")"
    - path: "src/lib/actions/projects.ts"
      provides: "Projects CRUD with public revalidation"
      contains: "revalidatePath(\"/\")"
    - path: "src/lib/actions/github.ts"
      provides: "GitHub import with public revalidation"
      contains: "revalidatePath(\"/\")"
  key_links:
    - from: "Server action mutation success"
      to: "revalidatePath call"
      via: "Called before return statement"
      pattern: "revalidatePath.*return success"
---

<objective>
Add instant cache revalidation and "now live" toast feedback to all admin content mutations.

Purpose: Eliminate the 60-second ISR delay when admin saves content, providing instant public visibility with visual confirmation.

Output: All server actions that modify displayed content call `revalidatePath("/")`, and all toast messages confirm "now live" status.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-cache-revalidation/07-RESEARCH.md

Reference pattern (bio.ts lines 83-85):
```typescript
revalidatePath("/backstage/dashboard/bio");
revalidatePath("/"); // Public homepage
```
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add revalidatePath("/") to all server actions</name>
  <files>
    src/lib/actions/contact.ts
    src/lib/actions/social-links.ts
    src/lib/actions/resume.ts
    src/lib/actions/skills.ts
    src/lib/actions/projects.ts
    src/lib/actions/github.ts
  </files>
  <action>
Add `revalidatePath("/")` to each mutation function's success path, BEFORE the return statement.

**contact.ts:**
- Add `import { revalidatePath } from "next/cache";` at top
- In `updateContact`: Add after line 65 (before `return success(contact)`):
  ```typescript
  revalidatePath("/backstage/dashboard/contact");
  revalidatePath("/");
  ```

**social-links.ts:**
- Add `import { revalidatePath } from "next/cache";` at top
- In `createSocialLink`: Add before line 60 (`return success(socialLink)`):
  ```typescript
  revalidatePath("/backstage/dashboard/contact");
  revalidatePath("/");
  ```
- In `updateSocialLink`: Add before line 104 (`return success(socialLink)`):
  ```typescript
  revalidatePath("/backstage/dashboard/contact");
  revalidatePath("/");
  ```
- In `deleteSocialLink`: Add before line 129 (`return success()`):
  ```typescript
  revalidatePath("/backstage/dashboard/contact");
  revalidatePath("/");
  ```
- In `updateSocialLinksOrder`: Add before line 164 (`return success()`):
  ```typescript
  revalidatePath("/backstage/dashboard/contact");
  revalidatePath("/");
  ```

**resume.ts:**
- Already imports revalidatePath
- In `uploadResume`: Add after line 62 (after existing revalidatePath):
  ```typescript
  revalidatePath("/");
  ```
- In `deleteResume`: Add after line 89 (after existing revalidatePath):
  ```typescript
  revalidatePath("/");
  ```

**skills.ts:**
- Already imports revalidatePath
- In `createSkill`: Add after line 144 (after existing revalidatePath):
  ```typescript
  revalidatePath("/");
  ```
- In `updateSkill`: Add after line 208 (after existing revalidatePath):
  ```typescript
  revalidatePath("/");
  ```
- In `deleteSkill`: Add after line 238 (after existing revalidatePath):
  ```typescript
  revalidatePath("/");
  ```
- In `updateSkillsOrder`: Add after line 273 (after existing revalidatePath):
  ```typescript
  revalidatePath("/");
  ```
- In `updateCategoryOrder`: Add after line 342 (after existing revalidatePath):
  ```typescript
  revalidatePath("/");
  ```

**projects.ts:**
- Already imports revalidatePath
- In `createProject`: Add after line 89 (after existing revalidatePath):
  ```typescript
  revalidatePath("/");
  ```
- In `updateProject`: Add after line 171 (after existing revalidatePath):
  ```typescript
  revalidatePath("/");
  ```
- In `deleteProject`: Add after line 197 (after existing revalidatePath):
  ```typescript
  revalidatePath("/");
  ```
- In `updateProjectsOrder`: Add after line 231 (after existing revalidatePath):
  ```typescript
  revalidatePath("/");
  ```
- In `toggleProjectVisibility`: Add after line 263 (after existing revalidatePath):
  ```typescript
  revalidatePath("/");
  ```
- In `updateProjectImage`: Add after line 297 (after existing revalidatePath):
  ```typescript
  revalidatePath("/");
  ```

**github.ts:**
- Already imports revalidatePath
- In `importRepositoriesAsProjects`: Add after line 249 (after existing revalidatePaths):
  ```typescript
  revalidatePath("/");
  ```
- In `resetProjectFieldToGitHub`: Add after line 472 (after existing revalidatePath):
  ```typescript
  revalidatePath("/");
  ```
  </action>
  <verify>
Run: `grep -r "revalidatePath(\"/\")" src/lib/actions/`
Expected: At least 18 matches (contact: 1, social-links: 4, resume: 2, skills: 5, projects: 6, github: 2)
  </verify>
  <done>
All mutation functions in server actions include `revalidatePath("/")` in their success paths.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update toast messages with "now live" confirmation</name>
  <files>
    src/app/backstage/dashboard/bio/bio-form.tsx
    src/app/backstage/dashboard/contact/contact-manager.tsx
    src/app/backstage/dashboard/skills/skills-manager.tsx
    src/app/backstage/dashboard/projects/projects-manager.tsx
    src/components/admin/project-form-modal.tsx
  </files>
  <action>
Update toast.success() calls to include "now live" confirmation, keeping messages concise (under 50 chars).

**bio-form.tsx:**
- Line 74: `"Bio saved successfully"` -> `"Bio saved - now live on site"`
- Line 148: `"Profile image updated"` -> `"Profile image updated - now live"`

**contact-manager.tsx:**
- Line 105: `"Contact information saved"` -> `"Contact updated - now live"`
- Line 150: `"Social link updated"` -> `"Social link updated - now live"`
- Line 160: `"Social link added"` -> `"Social link added - now live"`
- Line 177: `"Social link deleted"` -> `"Social link removed from site"`

**skills-manager.tsx:**
- Line 141: `"Categories reordered"` -> `"Categories reordered - now live"`
- Line 198: `"Skills reordered"` -> `"Skills reordered - now live"`
- Line 218: `toast.success(\`Added "${newSkill.name}"\`)` -> `toast.success(\`"${newSkill.name}" added - now live\`)`
- Line 246: `toast.success(\`Updated "${updatedSkill.name}"\`)` -> `toast.success(\`"${updatedSkill.name}" updated - now live\`)`
- Line 268: `toast.success(\`Deleted "${skill.name}"\`)` -> `toast.success(\`"${skill.name}" removed from site\`)`

**projects-manager.tsx:**
- Line 95: `"Order saved"` -> `"Order saved - now live"`
- Line 138: `"Project deleted"` -> `"Project removed from site"`
- Line 161: `toast.success(result.data?.visible ? "Project visible" : "Project hidden")` -> `toast.success(result.data?.visible ? "Project visible - now live" : "Project hidden from site")`

**project-form-modal.tsx:**
- Line 273: `toast.success(\`${field...} reset to GitHub value\`)` -> `toast.success(\`${field...} reset to GitHub - now live\`)`
  </action>
  <verify>
Run: `grep -r "now live\|from site" src/app/backstage/dashboard/ src/components/admin/project-form-modal.tsx`
Expected: At least 12 matches across the files.
  </verify>
  <done>
All success toast messages include "now live" or "from site" confirmation text.
  </done>
</task>

<task type="auto">
  <name>Task 3: Migrate resume-manager.tsx from custom toast to sonner</name>
  <files>
    src/app/backstage/dashboard/resume/resume-manager.tsx
  </files>
  <action>
Replace the custom toast implementation with sonner for consistency.

1. Add import at top:
   ```typescript
   import { toast } from "sonner";
   ```

2. Remove the custom toast state (lines 22-25):
   ```typescript
   // DELETE: const [toast, setToast] = useState<{...} | null>(null);
   ```

3. Remove the showToast function (lines 29-32):
   ```typescript
   // DELETE: const showToast = (message: string, type: ...) => {...}
   ```

4. Remove the toast JSX element (lines 156-166):
   ```typescript
   // DELETE: {toast && (<div className="fixed...">...</div>)}
   ```

5. Replace all showToast calls with sonner toast:
   - Line 60: `showToast(validation.error, "error")` -> `toast.error(validation.error)`
   - Line 72: `showToast(urlResult.error || "...", "error")` -> `toast.error(urlResult.error || "Failed to get upload URL")`
   - Line 87: `showToast("Failed to upload file", "error")` -> `toast.error("Failed to upload file")`
   - Line 97: `showToast(result.error || "...", "error")` -> `toast.error(result.error || "Failed to save resume")`
   - Line 104: `showToast("Resume uploaded successfully", "success")` -> `toast.success("Resume uploaded - now available")`
   - Line 107: `showToast("An error occurred during upload", "error")` -> `toast.error("An error occurred during upload")`
   - Line 123: `showToast(result.error || "...", "error")` -> `toast.error(result.error || "Failed to delete resume")`
   - Line 130: `showToast("Resume deleted", "success")` -> `toast.success("Resume removed from site")`
   - Line 133: `showToast("An error occurred while deleting", "error")` -> `toast.error("An error occurred while deleting")`
  </action>
  <verify>
Run: `grep -E "(showToast|setToast|useState.*toast)" src/app/backstage/dashboard/resume/resume-manager.tsx`
Expected: No matches (all custom toast code removed).

Run: `grep "from \"sonner\"" src/app/backstage/dashboard/resume/resume-manager.tsx`
Expected: 1 match (import statement).
  </verify>
  <done>
resume-manager.tsx uses sonner toast library consistently with all other dashboard components.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation:
   ```bash
   npm run build
   ```
   Expected: Build succeeds with no type errors.

2. Verify revalidatePath coverage:
   ```bash
   grep -r "revalidatePath(\"/\")" src/lib/actions/ | wc -l
   ```
   Expected: At least 18 occurrences.

3. Verify toast consistency:
   ```bash
   grep -r "from \"sonner\"" src/app/backstage/dashboard/
   ```
   Expected: All manager components import from sonner.
</verification>

<success_criteria>
1. All server actions that modify displayed content call `revalidatePath("/")` after successful database operations.
2. All success toast messages include "now live" or "from site" confirmation.
3. resume-manager.tsx uses sonner instead of custom toast state.
4. Build succeeds with no TypeScript errors.
</success_criteria>

<output>
After completion, create `.planning/phases/07-cache-revalidation/07-01-SUMMARY.md`
</output>
