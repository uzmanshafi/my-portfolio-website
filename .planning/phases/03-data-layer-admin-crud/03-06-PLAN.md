---
phase: 03-data-layer-admin-crud
plan: 06
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/lib/validations/contact.ts
  - src/lib/actions/contact.ts
  - src/lib/actions/social-links.ts
  - src/components/admin/sortable-social-link.tsx
  - src/app/backstage/dashboard/contact/page.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can update contact email"
    - "Admin can add new social media links with platform, URL, and icon"
    - "Admin can edit existing social links"
    - "Admin can remove social links with confirmation"
    - "Admin can reorder social links via drag-and-drop"
    - "Changes save with visual feedback"
  artifacts:
    - path: "src/lib/validations/contact.ts"
      provides: "Zod schemas for contact and social links"
      exports: ["contactSchema", "socialLinkSchema", "ContactFormData", "SocialLinkFormData"]
    - path: "src/lib/actions/contact.ts"
      provides: "Server actions for contact info"
      exports: ["getContact", "updateContact"]
    - path: "src/lib/actions/social-links.ts"
      provides: "Server actions for social links CRUD"
      exports: ["getSocialLinks", "createSocialLink", "updateSocialLink", "deleteSocialLink", "updateSocialLinksOrder"]
    - path: "src/components/admin/sortable-social-link.tsx"
      provides: "Draggable social link item"
      exports: ["SortableSocialLink"]
    - path: "src/app/backstage/dashboard/contact/page.tsx"
      provides: "Contact management page"
  key_links:
    - from: "src/app/backstage/dashboard/contact/page.tsx"
      to: "src/lib/actions/contact.ts"
      via: "form submission"
      pattern: "updateContact"
    - from: "src/app/backstage/dashboard/contact/page.tsx"
      to: "@dnd-kit/sortable"
      via: "social links reordering"
      pattern: "SortableContext"
---

<objective>
Build the Contact section with email editing and social media links management including CRUD and drag-and-drop reordering.

Purpose: Allow admin to update contact email and manage social media links (GitHub, LinkedIn, Twitter, etc.) with custom icons and ordering.

Output: Functional contact page with email form and sortable social links list.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-data-layer-admin-crud/03-CONTEXT.md
@.planning/phases/03-data-layer-admin-crud/03-RESEARCH.md
@prisma/schema.prisma
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create contact and social link validation and actions</name>
  <files>
    - src/lib/validations/contact.ts
    - src/lib/actions/contact.ts
    - src/lib/actions/social-links.ts
  </files>
  <action>
Create `src/lib/validations/contact.ts`:
- Contact schema: email (required, valid email format), location (optional string)
- Social link schema: platform (required, 1-50 chars), url (required, valid URL), icon (required, Lucide icon name)
- Export `contactSchema`, `socialLinkSchema`, `ContactFormData`, `SocialLinkFormData`
- Export `COMMON_PLATFORMS` constant with suggested platforms: github, linkedin, twitter/x, instagram, youtube, email

Create `src/lib/actions/contact.ts`:
- "use server"
- `getContact()`: Fetch contact record (use findFirst, may not exist)
- `updateContact(formData: FormData)`: Validate, upsert contact record with singleton pattern

Create `src/lib/actions/social-links.ts`:
- "use server"
- `getSocialLinks()`: Fetch all social links ordered by order field
- `createSocialLink(formData: FormData)`: Validate, create with order = max + 1
- `updateSocialLink(id: string, formData: FormData)`: Validate and update
- `deleteSocialLink(id: string)`: Delete by ID
- `updateSocialLinksOrder(updates: { id: string; order: number }[])`: Bulk order update

All actions check auth first.
  </action>
  <verify>
- Files exist with correct exports
- `npx tsc --noEmit` passes
  </verify>
  <done>
Contact and social link validation and server actions ready.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create sortable social link component</name>
  <files>
    - src/components/admin/sortable-social-link.tsx
  </files>
  <action>
Create `src/components/admin/sortable-social-link.tsx`:
- "use client"
- Use useSortable from @dnd-kit/sortable
- Props: socialLink object, onEdit callback, onDelete callback
- Display:
  - Drag handle (GripVertical icon)
  - Platform icon (dynamic Lucide icon from socialLink.icon)
  - Platform name
  - URL (truncated if long)
  - Edit button (Pencil)
  - Delete button (Trash2)
- Apply CSS transform from useSortable
- Visual feedback when dragging
  </action>
  <verify>
- File exists with correct export
- `npx tsc --noEmit` passes
  </verify>
  <done>
Sortable social link component ready with drag handle and action buttons.
  </done>
</task>

<task type="auto">
  <name>Task 3: Build contact management page</name>
  <files>
    - src/app/backstage/dashboard/contact/page.tsx
  </files>
  <action>
Create `src/app/backstage/dashboard/contact/page.tsx`:

Server component wrapper:
- Fetch contact with getContact()
- Fetch social links with getSocialLinks()
- Pass to client ContactManager component

Client ContactManager component:
- "use client"

Contact Email Section:
- Form with email input (and optional location)
- Use react-hook-form with zodResolver(contactSchema)
- Validate on blur
- Save button
- On submit: updateContact, show toast
- Use useUnsavedChanges for dirty state

Social Links Section:
- Header: "Social Links" with "Add Link" button
- DndContext + SortableContext with social links
- Render SortableSocialLink for each link
- Empty state if no links

Add/Edit Social Link Modal:
- Opens on "Add Link" or Edit button click
- Form fields:
  - Platform name (text input, suggestions from COMMON_PLATFORMS)
  - URL (text input)
  - Icon (text input for Lucide icon name, show preview)
- Validate with zodResolver(socialLinkSchema)
- Create or update based on mode
- Show toast on success

Delete Social Link:
- Confirmation dialog
- On confirm: deleteSocialLink, show toast

Reorder Social Links:
- On drag end: calculate orders, call updateSocialLinksOrder
- Use useOptimistic (in startTransition)
- Revert on error

Page layout:
- Two sections: Contact Info (top), Social Links (bottom)
- Clear visual separation
  </action>
  <verify>
- Visit `/backstage/dashboard/contact` - page loads
- Update email: saves, toast shown
- Add social link: modal opens, creates link
- Edit social link: modal pre-fills, updates work
- Delete social link: confirmation, then removed
- Drag reorder: instant feedback, persists
- Refresh: all changes persist
  </verify>
  <done>
Contact section complete: email editing, social links CRUD with drag-and-drop reordering.
  </done>
</task>

</tasks>

<verification>
1. Navigate to `/backstage/dashboard/contact`
2. Enter/update email address, save - persists
3. Add a social link (e.g., GitHub with github icon)
4. Add another social link
5. Drag to reorder - instant feedback
6. Refresh - order persists
7. Edit a link - changes save
8. Delete a link - removed after confirmation
</verification>

<success_criteria>
- Contact email saves with validation
- Social links CRUD operations work
- Drag-and-drop reorders social links
- Icon preview shows correct Lucide icon
- Optimistic updates provide instant feedback
- Toast notifications for all operations
- Forms track dirty state
</success_criteria>

<output>
After completion, create `.planning/phases/03-data-layer-admin-crud/03-06-SUMMARY.md`
</output>
