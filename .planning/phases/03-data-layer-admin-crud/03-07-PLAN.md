---
phase: 03-data-layer-admin-crud
plan: 07
type: execute
wave: 3
depends_on: ["03-02", "03-03", "03-04", "03-05", "03-06"]
files_modified:
  - src/lib/actions/dashboard.ts
  - src/app/backstage/dashboard/page.tsx
  - src/components/admin/sidebar.tsx
autonomous: true

must_haves:
  truths:
    - "Dashboard home shows stats summary (project count, skill count)"
    - "Dashboard home shows quick links to all sections"
    - "Sidebar shows unsaved changes indicator when form is dirty"
    - "Unsaved changes modal appears when clicking sidebar link with dirty form"
  artifacts:
    - path: "src/lib/actions/dashboard.ts"
      provides: "Server action for dashboard stats"
      exports: ["getDashboardStats"]
    - path: "src/app/backstage/dashboard/page.tsx"
      provides: "Dashboard home page with overview"
  key_links:
    - from: "src/components/admin/sidebar.tsx"
      to: "src/components/admin/unsaved-changes-modal.tsx"
      via: "conditional render on navigation"
      pattern: "UnsavedChangesModal"
---

<objective>
Complete the dashboard home page with stats overview and wire up the unsaved changes warning system across all sections.

Purpose: Provide admin with at-a-glance overview of portfolio content and prevent accidental data loss from navigating away with unsaved changes.

Output: Dashboard home with content stats, and functional unsaved changes warning when navigating between sections.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-data-layer-admin-crud/03-CONTEXT.md
@src/components/admin/sidebar.tsx
@src/components/admin/unsaved-changes-modal.tsx
@src/hooks/use-unsaved-changes.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create dashboard stats action and update home page</name>
  <files>
    - src/lib/actions/dashboard.ts
    - src/app/backstage/dashboard/page.tsx
  </files>
  <action>
Create `src/lib/actions/dashboard.ts`:
- "use server"
- `getDashboardStats()`: Return aggregate counts:
  - projectCount: total projects
  - visibleProjectCount: projects where visible = true
  - skillCount: total skills
  - skillCategoryCount: unique categories
  - hasBio: boolean (bio exists with content)
  - hasResume: boolean (active resume exists)
  - socialLinkCount: total social links
- No auth check needed (stats are not sensitive, page is protected)

Update `src/app/backstage/dashboard/page.tsx`:
- Remove "Coming Soon" placeholder
- Fetch stats with getDashboardStats()

Display:
- Welcome message with user email (existing)
- Stats cards grid:
  - Projects card: "X projects (Y visible)" with FolderKanban icon
  - Skills card: "X skills in Y categories" with Zap icon
  - Bio card: "Bio configured" / "Bio not set" with User icon
  - Resume card: "Resume uploaded" / "No resume" with FileText icon
  - Social card: "X social links" with Share2 icon
- Quick links section:
  - Buttons/cards linking to each section
  - "Edit Bio", "Manage Skills", "Manage Projects", "Upload Resume", "Update Contact"
  - Use Link from next/link

Visual styling:
- Grid layout (responsive: 1 col mobile, 2-3 cols desktop)
- Cards with subtle borders and hover states
- Icons with section colors
- Consistent with dark theme
  </action>
  <verify>
- Visit `/backstage/dashboard` - shows stats and quick links
- Stats reflect actual database content
- Quick links navigate to correct pages
- Responsive layout works on mobile
  </verify>
  <done>
Dashboard home displays content stats and quick navigation links.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire unsaved changes warning to sidebar navigation</name>
  <files>
    - src/components/admin/sidebar.tsx
  </files>
  <action>
Update `src/components/admin/sidebar.tsx` to handle unsaved changes:

Approach: Use React Context to share dirty state across dashboard.

Create UnsavedChangesContext:
- Create context in sidebar file or separate context file
- Provider wraps dashboard content
- Value: `{ isDirty, setIsDirty, pendingNavigation, setPendingNavigation }`

Update Sidebar component:
- Import UnsavedChangesModal
- Track pendingNavigation state (URL user wants to navigate to)
- On sidebar link click:
  - If isDirty: prevent navigation, set pendingNavigation to target URL, show modal
  - If not dirty: navigate normally
- Modal onConfirm: navigate to pendingNavigation, clear state
- Modal onCancel: clear pendingNavigation, close modal

Show dirty indicator:
- Small dot (or different color) next to active section when dirty
- Use CSS variables for indicator color (accent or primary)

Update section pages to use context:
- Each form page should call setIsDirty(formState.isDirty)
- On successful save, form resets and isDirty becomes false
- This requires updating bio, skills, projects, resume, contact pages to use context

Alternative simpler approach (if context is too complex):
- Store dirty state in sessionStorage
- Sidebar reads from sessionStorage
- Forms write to sessionStorage
- Less elegant but works without prop drilling

Choose the approach that best fits the existing code structure.
  </action>
  <verify>
- Navigate to Bio page, make a change (don't save)
- Click Skills in sidebar - modal appears
- Click "Stay" - stays on Bio page
- Click "Leave" - navigates to Skills (changes lost)
- Dirty indicator shows in sidebar when form has changes
- After saving, dirty indicator disappears
  </verify>
  <done>
Unsaved changes warning prevents accidental navigation. Dirty indicator shows in sidebar.
  </done>
</task>

</tasks>

<verification>
1. Visit `/backstage/dashboard` - stats cards show correct counts
2. Click quick link - navigates to section
3. Go to Bio, make change, don't save
4. Click Skills in sidebar - warning modal appears
5. Click Stay - remains on Bio
6. Click Leave - goes to Skills
7. Verify dirty indicator visible when form has unsaved changes
8. Save changes - indicator disappears
</verification>

<success_criteria>
- Dashboard home shows accurate content statistics
- Quick links navigate to all five sections
- Unsaved changes modal prevents accidental data loss
- Sidebar shows visual indicator for dirty forms
- All sections integrated with unsaved changes system
</success_criteria>

<output>
After completion, create `.planning/phases/03-data-layer-admin-crud/03-07-SUMMARY.md`
</output>
