---
phase: 08-seo-metadata
plan: 03
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - src/app/page.tsx
  - src/components/seo/json-ld.tsx
autonomous: false

must_haves:
  truths:
    - "Sharing portfolio URL on Twitter/X shows large image card with title and description"
    - "Sharing portfolio URL on LinkedIn/Facebook shows Open Graph preview with image"
    - "OG image displays at correct dimensions (1200x630) without cropping"
    - "Google search results can display Person rich result with structured data"
  artifacts:
    - path: "src/app/page.tsx"
      provides: "Extended generateMetadata with OG and Twitter tags"
      contains: "openGraph"
    - path: "src/components/seo/json-ld.tsx"
      provides: "JSON-LD injection component"
      exports: ["JsonLd"]
  key_links:
    - from: "src/app/page.tsx"
      to: "src/lib/data/portfolio.ts"
      via: "getPortfolioData call"
      pattern: "getPortfolioData"
    - from: "src/app/page.tsx"
      to: "src/components/seo/json-ld.tsx"
      via: "JsonLd component import"
      pattern: "JsonLd"
    - from: "src/components/seo/json-ld.tsx"
      to: "schema-dts types"
      via: "type imports"
      pattern: "schema-dts"
---

<objective>
Implement public-facing SEO metadata: Open Graph tags, Twitter Card tags, and JSON-LD structured data.

Purpose: Enable rich social media previews when portfolio is shared and structured data for Google search results.

Output: Extended generateMetadata function with OG/Twitter tags, and JsonLd component for Person/WebSite schemas.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-seo-metadata/08-RESEARCH.md
@.planning/phases/08-seo-metadata/08-01-SUMMARY.md

@src/app/page.tsx
@src/lib/data/portfolio.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install schema-dts and configure NEXT_PUBLIC_SITE_URL</name>
  <files>package.json, .env.local, .env.example</files>
  <action>
**Install schema-dts:**
```bash
npm install --save-dev schema-dts
```

**Add environment variable:**
Add to `.env.local`:
```
NEXT_PUBLIC_SITE_URL=http://localhost:3000
```

Add to `.env.example` (or create if not exists):
```
NEXT_PUBLIC_SITE_URL=https://your-domain.com
```

This variable is required for metadataBase to generate absolute URLs for OG images.
Note: Production value must be set in Render environment variables.
  </action>
  <verify>
`npm ls schema-dts` shows package installed.
`grep NEXT_PUBLIC_SITE_URL .env.local` returns the variable.
  </verify>
  <done>
- schema-dts installed as devDependency
- NEXT_PUBLIC_SITE_URL configured in .env.local
- .env.example documents the required variable
  </done>
</task>

<task type="auto">
  <name>Task 2: Create JSON-LD component and extend generateMetadata</name>
  <files>src/components/seo/json-ld.tsx, src/app/page.tsx</files>
  <action>
**Create JsonLd component** at `src/components/seo/json-ld.tsx`:

```typescript
import type { Person, WebSite, WithContext } from "schema-dts";

interface JsonLdProps {
  bio: { name: string; title: string; imageUrl?: string | null } | null;
  siteUrl: string;
  socialLinks: { url: string }[];
}

export function JsonLd({ bio, siteUrl, socialLinks }: JsonLdProps) {
  // Build Person schema with sameAs for social profiles
  const personSchema: WithContext<Person> = {
    "@context": "https://schema.org",
    "@type": "Person",
    name: bio?.name || "Developer",
    jobTitle: bio?.title || "Software Developer",
    url: siteUrl,
    image: bio?.imageUrl || undefined,
    sameAs: socialLinks.map(link => link.url),
  };

  // Build WebSite schema
  const websiteSchema: WithContext<WebSite> = {
    "@context": "https://schema.org",
    "@type": "WebSite",
    name: `${bio?.name || "Developer"} Portfolio`,
    url: siteUrl,
  };

  // Sanitize to prevent XSS (replace < with unicode escape)
  const sanitize = (obj: object) =>
    JSON.stringify(obj).replace(/</g, "\\u003c");

  return (
    <>
      <script
        type="application/ld+json"
        dangerouslySetInnerHTML={{ __html: sanitize(personSchema) }}
      />
      <script
        type="application/ld+json"
        dangerouslySetInnerHTML={{ __html: sanitize(websiteSchema) }}
      />
    </>
  );
}
```

**Extend generateMetadata in page.tsx:**

Update the existing generateMetadata function to include:

1. metadataBase using NEXT_PUBLIC_SITE_URL
2. Full openGraph object with:
   - title (custom or fallback to bio.name | bio.title)
   - description (custom or fallback to bio.headline)
   - url (site URL)
   - siteName (bio.name or "Portfolio")
   - images array with OG image (1200x630)
   - type: "website"
   - locale: "en_US"
3. twitter object with:
   - card: "summary_large_image"
   - title, description, images (same as OG)
4. other object for LinkedIn:
   - "article:author": bio.name

Fallback chain for values:
- Title: seoSettings.seoTitle || `${bio.name} | ${bio.title}` || "Portfolio"
- Description: seoSettings.seoDescription || bio.headline || "Personal portfolio"
- Image: seoSettings.ogImageUrl || bio.imageUrl || default

**Add JsonLd to page render:**
Import JsonLd component and render it inside the main element, passing bio, siteUrl, and socialLinks.
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
Dev server runs without errors.
View page source - see og:title, og:image, twitter:card, and JSON-LD scripts.
  </verify>
  <done>
- JsonLd component renders Person and WebSite schemas
- generateMetadata returns complete OG and Twitter metadata
- Fallback chain works (custom SEO -> bio data -> defaults)
- JSON-LD properly sanitized against XSS
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete SEO metadata implementation:
- Open Graph meta tags for Facebook/LinkedIn
- Twitter Card meta tags for Twitter/X
- JSON-LD structured data for Google
  </what-built>
  <how-to-verify>
1. View page source at http://localhost:3000
2. Verify these meta tags exist:
   - og:title, og:description, og:image, og:url, og:type
   - twitter:card (should be "summary_large_image"), twitter:title, twitter:image
3. Verify JSON-LD scripts:
   - Search for "application/ld+json" in source
   - Should see Person schema with @type, name, jobTitle, url
   - Should see WebSite schema with @type, name, url

4. Test with validators (optional but recommended):
   - Facebook: https://developers.facebook.com/tools/debug/ (paste localhost URL - won't work, but can test production later)
   - Google: https://search.google.com/test/rich-results (paste production URL after deploy)
  </how-to-verify>
  <resume-signal>Type "approved" if meta tags and JSON-LD appear correctly in page source, or describe issues.</resume-signal>
</task>

</tasks>

<verification>
1. Page source contains og:title, og:description, og:image meta tags
2. Page source contains twitter:card="summary_large_image"
3. Page source contains two JSON-LD script blocks (Person, WebSite)
4. JSON-LD contains sameAs array with social link URLs
5. No TypeScript errors
6. Dev server runs without console errors
</verification>

<success_criteria>
- Twitter/X sharing shows large image card with title and description (requirement SEO-02)
- LinkedIn/Facebook sharing shows Open Graph preview (requirement SEO-01)
- OG image dimensions are 1200x630 as specified (requirement SEO-03)
- JSON-LD includes Person schema with jobTitle, url, sameAs (requirement SEO-04)
- All metadata falls back gracefully when custom SEO fields are empty
</success_criteria>

<output>
After completion, create `.planning/phases/08-seo-metadata/08-03-SUMMARY.md`
</output>
