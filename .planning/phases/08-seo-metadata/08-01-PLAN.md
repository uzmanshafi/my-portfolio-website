---
phase: 08-seo-metadata
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - prisma/schema.prisma
  - src/lib/validations/seo.ts
  - src/lib/actions/seo.ts
  - src/lib/data/portfolio.ts
autonomous: true

must_haves:
  truths:
    - "SEO settings can be stored and retrieved from database"
    - "SEO fields are validated before saving"
    - "Portfolio data fetch includes SEO settings alongside bio, contact, etc."
  artifacts:
    - path: "prisma/schema.prisma"
      provides: "SeoSettings model"
      contains: "model SeoSettings"
    - path: "src/lib/validations/seo.ts"
      provides: "Zod validation schema for SEO form"
      exports: ["seoSchema", "SeoFormData"]
    - path: "src/lib/actions/seo.ts"
      provides: "Server actions for SEO CRUD"
      exports: ["getSeoSettings", "updateSeoSettings", "updateOgImage"]
    - path: "src/lib/data/portfolio.ts"
      provides: "Extended getPortfolioData with SEO settings"
      contains: "getPublicSeoSettings"
  key_links:
    - from: "src/lib/actions/seo.ts"
      to: "prisma.seoSettings"
      via: "upsert/findFirst queries"
      pattern: "prisma\\.seoSettings\\."
    - from: "src/lib/data/portfolio.ts"
      to: "prisma.seoSettings"
      via: "findFirst query"
      pattern: "seoSettings"
---

<objective>
Create SEO data infrastructure: database model, validation schema, server actions, and public data layer extension.

Purpose: Enable storage and retrieval of custom SEO settings (OG image URL, custom title, custom description) that the admin can configure and the public site can use for metadata generation.

Output: SeoSettings model in schema, Zod validation, server actions following project patterns, and extended portfolio data fetcher.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-seo-metadata/08-RESEARCH.md

@prisma/schema.prisma
@src/lib/actions/bio.ts
@src/lib/validations/bio.ts
@src/lib/data/portfolio.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add SeoSettings model and run migration</name>
  <files>prisma/schema.prisma</files>
  <action>
Add SeoSettings model to schema.prisma after existing models:

```prisma
// SEO metadata settings (singleton - one record)
model SeoSettings {
  id             String   @id @default(cuid())
  ogImageUrl     String?  // Supabase storage URL for OG image (1200x630)
  seoTitle       String?  // Custom title (fallback to bio.name + bio.title)
  seoDescription String?  // Custom description (fallback to bio.headline)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}
```

After adding model, run `npx prisma db push` to sync schema with database.

Verify with `npx prisma studio` that SeoSettings table exists.
  </action>
  <verify>
Run `npx prisma db push` completes without errors.
Run `npx prisma studio` and verify SeoSettings table is visible in the browser.
  </verify>
  <done>SeoSettings model exists in schema and database table is created.</done>
</task>

<task type="auto">
  <name>Task 2: Create SEO validation schema and server actions</name>
  <files>src/lib/validations/seo.ts, src/lib/actions/seo.ts</files>
  <action>
**Create validation schema** at `src/lib/validations/seo.ts`:
- seoTitle: optional string, max 60 chars (recommended OG title length)
- seoDescription: optional string, max 160 chars (recommended meta description)
- Export `seoSchema` and `SeoFormData` type

**Create server actions** at `src/lib/actions/seo.ts` following established patterns from bio.ts:

1. `getSeoSettings()` - Fetch current SEO settings, return null if not exists
2. `updateSeoSettings(formData: FormData)` - Update seoTitle and seoDescription with validation
3. `updateOgImage(imageUrl: string)` - Update only the OG image URL (called after Supabase upload)

All mutating actions must:
- Check auth session
- Call `revalidatePath("/")` after successful update
- Return `ActionResult` type matching bio.ts pattern
- Use singleton ID pattern like bio.ts (`SEO_ID = "main"`)
  </action>
  <verify>
TypeScript compiles without errors: `npx tsc --noEmit`
Imports resolve correctly in both files.
  </verify>
  <done>
- src/lib/validations/seo.ts exports seoSchema and SeoFormData
- src/lib/actions/seo.ts exports getSeoSettings, updateSeoSettings, updateOgImage
- Actions follow project patterns (auth check, validation, revalidatePath)
  </done>
</task>

<task type="auto">
  <name>Task 3: Extend portfolio data layer with SEO settings</name>
  <files>src/lib/data/portfolio.ts</files>
  <action>
Extend the public data layer to include SEO settings:

1. Import SeoSettings type from generated Prisma client
2. Add `getPublicSeoSettings()` function - fetches first SeoSettings record
3. Update `PortfolioData` type to include `seoSettings: SeoSettings | null`
4. Update `getPortfolioData()` to fetch seoSettings in parallel with other data

This allows the public page to access SEO settings for metadata generation in a single data fetch.
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
Run dev server (`npm run dev`) and verify no runtime errors on homepage load.
  </verify>
  <done>
- getPublicSeoSettings function exists and returns SeoSettings | null
- PortfolioData type includes seoSettings field
- getPortfolioData fetches seoSettings alongside bio, skills, etc.
  </done>
</task>

</tasks>

<verification>
1. Database: `npx prisma studio` shows SeoSettings table
2. TypeScript: `npx tsc --noEmit` passes without errors
3. Server actions: All three functions exported from seo.ts
4. Data layer: getPortfolioData returns object with seoSettings field
</verification>

<success_criteria>
- SeoSettings model exists in Prisma schema and database
- Validation schema enforces title/description length limits
- Server actions follow established patterns (auth, validation, revalidation)
- Portfolio data layer fetches SEO settings in parallel with other data
- All TypeScript types correctly exported and imported
</success_criteria>

<output>
After completion, create `.planning/phases/08-seo-metadata/08-01-SUMMARY.md`
</output>
