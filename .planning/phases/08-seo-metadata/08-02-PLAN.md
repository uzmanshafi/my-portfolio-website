---
phase: 08-seo-metadata
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - src/components/admin/sidebar.tsx
  - src/components/admin/image-cropper.tsx
  - src/app/backstage/dashboard/seo/page.tsx
  - src/app/backstage/dashboard/seo/seo-manager.tsx
autonomous: true

must_haves:
  truths:
    - "SEO appears in dashboard sidebar navigation"
    - "Admin can edit SEO title and description fields"
    - "Admin can upload OG image with correct 1200x630 dimensions"
    - "Form shows current values and saves changes with toast feedback"
  artifacts:
    - path: "src/components/admin/sidebar.tsx"
      provides: "SEO nav item in sidebar"
      contains: "SEO"
    - path: "src/components/admin/image-cropper.tsx"
      provides: "Configurable aspect ratio support"
      contains: "aspect"
    - path: "src/app/backstage/dashboard/seo/page.tsx"
      provides: "SEO admin page (server component)"
      min_lines: 15
    - path: "src/app/backstage/dashboard/seo/seo-manager.tsx"
      provides: "SEO form client component"
      min_lines: 80
  key_links:
    - from: "src/app/backstage/dashboard/seo/seo-manager.tsx"
      to: "src/lib/actions/seo.ts"
      via: "server action calls"
      pattern: "(updateSeoSettings|updateOgImage)"
    - from: "src/components/admin/image-cropper.tsx"
      to: "seo-manager.tsx"
      via: "aspect prop"
      pattern: "aspect.*1200.*630|aspect.*1\\.91"
---

<objective>
Create admin SEO section with sidebar navigation, OG image upload, and text field editing.

Purpose: Allow admin to configure custom SEO title, description, and upload a properly-sized OG image for social sharing previews.

Output: New SEO sidebar item, enhanced ImageCropper with configurable aspect ratio, and complete SEO management UI.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-seo-metadata/08-RESEARCH.md
@.planning/phases/08-seo-metadata/08-01-SUMMARY.md

@src/components/admin/sidebar.tsx
@src/components/admin/image-cropper.tsx
@src/app/backstage/dashboard/bio/page.tsx
@src/app/backstage/dashboard/bio/bio-form.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add SEO to sidebar navigation and enhance ImageCropper</name>
  <files>src/components/admin/sidebar.tsx, src/components/admin/image-cropper.tsx</files>
  <action>
**Update sidebar.tsx:**
Add SEO nav item to navItems array, positioned after Contact and before GitHub:

```typescript
import { Settings } from "lucide-react";  // Add to imports

// In navItems array, add after Contact:
{ name: "SEO", href: "/backstage/dashboard/seo", icon: Settings },
```

**Update image-cropper.tsx:**
Make aspect ratio configurable via prop instead of hardcoded 1:1:

1. Add `aspect` prop to ImageCropperProps interface:
   ```typescript
   interface ImageCropperProps {
     imageSrc: string;
     onCropComplete: (blob: Blob) => void;
     onCancel: () => void;
     aspect?: number;      // Add this - defaults to 1 (square)
     cropShape?: "round" | "rect";  // Add this - defaults to "round"
   }
   ```

2. Update Cropper component to use props:
   ```typescript
   <Cropper
     aspect={aspect ?? 1}
     cropShape={cropShape ?? "round"}
     // ... other props
   />
   ```

This allows reuse for OG images (aspect={1200/630}, cropShape="rect") while maintaining backward compatibility with profile images.
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
Dev server shows SEO in sidebar navigation.
  </verify>
  <done>
- SEO nav item appears in sidebar between Contact and GitHub
- ImageCropper accepts optional aspect and cropShape props
- Existing profile image cropping still works (defaults maintained)
  </done>
</task>

<task type="auto">
  <name>Task 2: Create SEO admin page and manager component</name>
  <files>src/app/backstage/dashboard/seo/page.tsx, src/app/backstage/dashboard/seo/seo-manager.tsx</files>
  <action>
**Create server component** at `src/app/backstage/dashboard/seo/page.tsx`:
- Import and call getSeoSettings from actions
- Render page header ("SEO" title, description about social previews)
- Pass initialData to SeoManager client component
- Follow pattern from bio/page.tsx

**Create client component** at `src/app/backstage/dashboard/seo/seo-manager.tsx`:
Follow the bio-form.tsx pattern with these sections:

1. **State management:**
   - Form state for seoTitle, seoDescription
   - Image upload state (selectedImage, isCropperOpen, isUploading)
   - Saving state, dirty tracking

2. **OG Image section:**
   - Display current OG image if exists (show at reduced size, actual is 1200x630)
   - File input for selecting new image
   - ImageCropper with aspect={1200/630} and cropShape="rect"
   - Upload to Supabase storage (folder: "og-images")
   - Call updateOgImage action after upload
   - Show toast on success ("OG image now live")

3. **Text fields section:**
   - SEO Title input (max 60 chars) with character counter
   - SEO Description textarea (max 160 chars) with character counter
   - Placeholder text showing fallback behavior ("Leave empty to use bio data")

4. **Form submission:**
   - Save button calls updateSeoSettings action
   - Show toast on success ("SEO settings now live")
   - Disable button while saving
   - Track dirty state for unsaved changes warning

Use sonner for toasts, follow existing design system (CSS variables, button styles).
  </action>
  <verify>
Navigate to /backstage/dashboard/seo - page renders without errors.
Form fields are editable and character counters work.
TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>
- SEO page accessible at /backstage/dashboard/seo
- OG image upload works with 1200x630 cropping
- Text fields have character counters showing limits
- Form saves with toast confirmation
- Dirty state tracking integrated
  </done>
</task>

</tasks>

<verification>
1. Navigate to /backstage/dashboard - SEO appears in sidebar
2. Click SEO - page loads without errors
3. Upload test image - cropper shows rectangular (1.91:1) crop area
4. Save crop - image uploads to Supabase and displays
5. Edit title/description - character counters update
6. Save form - toast shows "SEO settings now live"
7. Refresh page - saved values persist
</verification>

<success_criteria>
- SEO navigation item visible and functional in sidebar
- ImageCropper supports both square (profile) and rectangular (OG) aspect ratios
- OG image upload enforces 1200x630 dimensions via cropper
- Text fields show character counts and enforce limits
- Form persists data to database and shows confirmation
- Design matches existing dashboard sections
</success_criteria>

<output>
After completion, create `.planning/phases/08-seo-metadata/08-02-SUMMARY.md`
</output>
