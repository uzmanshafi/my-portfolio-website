---
phase: 09-error-handling
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - src/lib/data/portfolio.ts
  - src/app/not-found.tsx
autonomous: true

must_haves:
  truths:
    - "Data fetch failures trigger error boundary instead of returning null/empty"
    - "Server logs contain structured JSON with error type, operation, timestamp"
    - "404 page matches error page visual design (icon, centered layout)"
  artifacts:
    - path: "src/lib/data/portfolio.ts"
      provides: "Data layer that throws on error"
      contains: "throw error"
    - path: "src/app/not-found.tsx"
      provides: "Enhanced 404 page matching error design"
      contains: "FileQuestion"
  key_links:
    - from: "src/lib/data/portfolio.ts"
      to: "src/app/error.tsx"
      via: "thrown error bubbles to boundary"
      pattern: "throw"
    - from: "src/app/not-found.tsx"
      to: "design system"
      via: "CSS variables"
      pattern: "var\\(--color-"
---

<objective>
Modify data layer to throw errors (triggering error boundaries) and enhance 404 page to match error design.

Purpose: Complete the error handling experience by ensuring data failures actually display error pages, and making 404 visually consistent with the error design.

Output: Modified portfolio.ts that throws instead of catches, enhanced not-found.tsx with icon and matching layout.
</objective>

<execution_context>
@/Users/uzi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/uzi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/09-error-handling/09-CONTEXT.md
@.planning/phases/09-error-handling/09-RESEARCH.md
@.planning/phases/09-error-handling/09-01-SUMMARY.md
@src/lib/data/portfolio.ts
@src/app/not-found.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Modify data layer to throw errors</name>
  <files>
    src/lib/data/portfolio.ts
  </files>
  <action>
Modify all data fetching functions in portfolio.ts to throw errors instead of catching and returning null/empty:

1. Create a helper function at top of file for structured logging:
```typescript
function logError(error: unknown, context: { operation: string; [key: string]: unknown }) {
  const errorObj = {
    timestamp: new Date().toISOString(),
    type: error instanceof Error ? error.constructor.name : 'UnknownError',
    message: error instanceof Error ? error.message : String(error),
    ...context,
  };
  console.error(JSON.stringify(errorObj));
}
```

2. Update each function (getPublicBio, getPublicSkills, getPublicProjects, getPublicContact, getPublicSocialLinks, getPublicResume, getPublicSeoSettings) to:
   - Keep the try block as-is
   - In catch block: call logError with operation name, then RE-THROW the error
   - Example for getPublicBio:
     ```typescript
     } catch (error) {
       logError(error, { operation: 'getPublicBio', table: 'Bio' });
       throw error;  // Re-throw to trigger error boundary
     }
     ```

3. Update getPortfolioData:
   - Remove try/catch entirely (let Promise.all propagate errors naturally)
   - Individual function errors will already be logged and thrown

This change means:
- Errors are logged server-side with structured JSON (visible in Render logs)
- Errors bubble up to error boundary, triggering branded error page
- No more silent failures returning null/empty
  </action>
  <verify>
    `npm run build` passes - TypeScript still valid after changes.
    No return type changes needed (functions already return Promise that can reject).
  </verify>
  <done>
    portfolio.ts contains logError helper function.
    All 7 individual fetch functions catch -> log -> throw (no return null/empty in catch).
    getPortfolioData has no try/catch wrapper.
  </done>
</task>

<task type="auto">
  <name>Task 2: Enhance 404 page to match error design</name>
  <files>
    src/app/not-found.tsx
  </files>
  <action>
Update not-found.tsx to match the error page visual design:

1. Import FileQuestion icon from lucide-react (represents "page not found" better than WifiOff)

2. Update layout to match error.tsx:
   - Keep: min-h-screen, flex column, items-center, justify-center, p-8
   - Add icon at top: FileQuestion with size={48}, opacity 0.6, color primary
   - Keep 404 heading but adjust size to match error page (text-4xl or similar)
   - Keep "Page not found" subtext
   - Keep "Go Home" button (same styling as error retry button)

3. Use CSS variables consistently:
   - var(--color-background) for page background (already set by body)
   - var(--color-text) for text
   - var(--color-primary) for icon and 404 number
   - var(--color-accent) for button background

4. Add className="mb-6" to icon for spacing consistency with error page

The goal is visual consistency: error page and 404 page should feel like siblings in the same design system.
  </action>
  <verify>
    `npm run build` passes.
    Visiting /nonexistent-page shows 404 with FileQuestion icon.
  </verify>
  <done>
    not-found.tsx imports FileQuestion from lucide-react.
    Icon displayed at 48px with opacity 0.6.
    Layout matches error page structure (icon, heading, subtext, button).
    CSS variables used for all colors.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. portfolio.ts contains "throw error" in each catch block (not "return null")
3. not-found.tsx contains FileQuestion import
4. Run dev server and visit /nonexistent-page - see branded 404 with icon
5. (Manual test) Temporarily break database connection - see branded error page
</verification>

<success_criteria>
- Data layer throws errors to trigger error boundaries
- Server logs contain structured JSON for debugging
- 404 page visually matches error page design
- Build passes with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/09-error-handling/09-02-SUMMARY.md`
</output>
