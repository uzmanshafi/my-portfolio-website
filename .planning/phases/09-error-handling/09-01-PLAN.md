---
phase: 09-error-handling
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/error.tsx
  - src/app/global-error.tsx
  - src/app/backstage/dashboard/error.tsx
autonomous: true

must_haves:
  truths:
    - "When database connection fails, user sees branded error page instead of crash"
    - "Error page displays connection icon, friendly message, and retry button"
    - "Admin dashboard shows error details on page, public shows clean message only"
    - "Pressing R key triggers page reload for retry"
  artifacts:
    - path: "src/app/error.tsx"
      provides: "Public portfolio error boundary"
      contains: "'use client'"
    - path: "src/app/global-error.tsx"
      provides: "Root layout error fallback with html/body"
      contains: "<html"
    - path: "src/app/backstage/dashboard/error.tsx"
      provides: "Admin dashboard error boundary with technical details"
      contains: "error.message"
  key_links:
    - from: "src/app/error.tsx"
      to: "design system"
      via: "CSS variables"
      pattern: "var\\(--color-"
    - from: "src/app/global-error.tsx"
      to: "design system"
      via: "inline styles (no CSS available)"
      pattern: "#160f09|#f3e9e2"
---

<objective>
Create Next.js error boundaries that display branded error pages when data fetches fail.

Purpose: Users see a professional, recoverable error experience instead of crashes or white screens. Public users get a clean message; admin sees technical details for debugging.

Output: Three error boundary files covering public portfolio, root layout, and admin dashboard.
</objective>

<execution_context>
@/Users/uzi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/uzi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/09-error-handling/09-CONTEXT.md
@.planning/phases/09-error-handling/09-RESEARCH.md
@src/app/globals.css
@src/app/not-found.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create public portfolio error boundaries</name>
  <files>
    src/app/error.tsx
    src/app/global-error.tsx
  </files>
  <action>
Create error.tsx at app root as a client component that:
- Displays WifiOff icon from lucide-react (48px, opacity 0.6)
- Shows heading "Oops! Something went wrong."
- Shows subtext "We're working on it." (opacity 0.7)
- Has "Try again" button that calls window.location.reload()
- Uses CSS variables: var(--color-background), var(--color-text), var(--color-accent)
- Adds useEffect to log structured JSON error to console with type, message, digest, timestamp, page path
- Adds useEffect for R key listener that triggers reload
- Layout: min-h-screen, flex column, items-center, justify-center, p-8

Create global-error.tsx as fallback for root layout errors:
- Must include own <html lang="en"> and <body> tags (no layout available)
- Uses inline styles with hex colors (#160f09, #f3e9e2, #6655b8) since CSS not loaded
- Same visual layout as error.tsx but simpler (no CSS vars available)
- WifiOff icon, heading, retry button
- No R key shortcut (keep it simple for global fallback)

Reference RESEARCH.md patterns for exact implementation. Do NOT use the reset() function - user decision is window.location.reload() for full page reload.
  </action>
  <verify>
    Files exist and TypeScript compiles: `npm run build` completes without error
  </verify>
  <done>
    src/app/error.tsx exists with 'use client', WifiOff icon, retry button calling reload(), R key listener, structured console logging.
    src/app/global-error.tsx exists with html/body tags, inline styles with hex colors, retry button.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create admin dashboard error boundary</name>
  <files>
    src/app/backstage/dashboard/error.tsx
  </files>
  <action>
Create error.tsx in backstage/dashboard/ as a client component that:
- Same base layout as public error.tsx (centered, WifiOff icon, retry button)
- ADDITIONALLY shows error details visible on page (not just console):
  - Box with slightly lighter background (rgba(243,233,226,0.05))
  - Border: 1px solid rgba(243,233,226,0.1)
  - Displays error.message in monospace font, opacity 0.6
  - If error.digest exists, shows "Digest: {digest}" in smaller text, opacity 0.4
- Heading says "Dashboard Error" instead of generic message
- Subtext: "Something went wrong loading this page."
- Uses same CSS variables as public error
- Same R key shortcut and structured console logging
- Console log includes stack trace for admin context

This gives admin more debugging info without requiring them to open dev tools.
  </action>
  <verify>
    File exists and TypeScript compiles: `npm run build` completes without error
  </verify>
  <done>
    src/app/backstage/dashboard/error.tsx exists with 'use client', technical error details visible in styled box, error.message and digest displayed, R key listener, console logging with stack trace.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without TypeScript errors
2. All three error boundary files exist at correct paths
3. Each file has 'use client' directive
4. global-error.tsx contains <html> and <body> tags
5. Dashboard error.tsx displays error.message on page
</verification>

<success_criteria>
- Three error boundary files created matching design system
- Public error shows clean user-friendly message
- Admin error shows technical details on page
- All use WifiOff icon, retry button, R key shortcut (except global-error)
- Build passes with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/09-error-handling/09-01-SUMMARY.md`
</output>
